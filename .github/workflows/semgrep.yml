name: Semgrep Full Scan

on:
  push:
    branches:
      - master
  schedule:
    # Run once a week, on Saturday at 01:00 UTC
    - cron: '0 1 * * 6'

jobs:
  semgrep-full:
    # Use the latest available GitHub runner image
    runs-on: ubuntu-latest
    
    # Use the official Semgrep action instead of a container
    steps:
      - name: Checkout application source code
        # actions/checkout@v4 is the latest major version
        uses: actions/checkout@v4
        
      # Use the official Semgrep GitHub Action for scanning
      - name: Run Semgrep
        uses: semgrep/semgrep-action@v1 # v1 is the latest stable major version
        with:
          config: |
            p/default
            p/typescript
            p/python
            p/javascript
            p/owasp-top-ten
            p/cwe-top-25
            
      - name: Save report as pipeline artifact
        uses: actions/upload-artifact@v4
        if: always() # Upload even if scan fails, as report.sarif might contain findings
        with:
          name: semgrep_result.sarif
          path: semgrep.sarif # Semgrep Action outputs to semgrep.sarif by default
